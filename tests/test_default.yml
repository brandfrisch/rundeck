---
- hosts: all
  gather_facts: true

  pre_tasks:

    - name: set distro-specific variables
      include_vars: "{{ ansible_os_family | lower }}.yml"
      ignore_errors: true

  post_tasks:

    - name: Copy tests to remote
      copy:
        content: "{{ goss | to_nice_yaml }}"
        dest: "/tmp/goss.yml"

    - name: test goss files
      goss:
        path: "/tmp/goss.yml"
        format: documentation